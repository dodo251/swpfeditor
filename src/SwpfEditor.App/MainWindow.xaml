<Window x:Class="SwpfEditor.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="SMS Script Editor" Height="600" Width="1100">
    <DockPanel>
        <ToolBarTray DockPanel.Dock="Top">
            <ToolBar>
                <Button Content="新建" Name="BtnNew" Click="BtnNew_OnClick" />
                <Button Content="打开" Name="BtnOpen" Click="BtnOpen_OnClick" />
                <Button Content="保存" Name="BtnSave" Click="BtnSave_OnClick" />
                <Separator/>
                <Button Content="撤销" Name="BtnUndo" IsEnabled="False" />
                <Button Content="重做" Name="BtnRedo" IsEnabled="False" />
                <Separator/>
                <Button Content="验证" Name="BtnValidate" Click="BtnValidate_OnClick" />
                <Separator/>
                <Button Content="导出运行时XML" Name="BtnExportRuntime" Click="BtnExportRuntime_OnClick" />
            </ToolBar>
        </ToolBarTray>
        
        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" />
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock>
                    <TextBlock.Text>
                        <MultiBinding StringFormat="错误: {0} | 文件: {1}">
                            <Binding Path="ValidationErrors.Count" />
                            <Binding Path="CurrentFilePath" Converter="{StaticResource FileNameConverter}" />
                        </MultiBinding>
                    </TextBlock.Text>
                </TextBlock>
            </StatusBarItem>
        </StatusBar>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="3*" />
                <ColumnDefinition Width="3*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="150" />
            </Grid.RowDefinitions>
            
            <!-- Left: Templates placeholder -->
            <Border Grid.Column="0" Grid.Row="0" BorderBrush="#CCC" BorderThickness="0,0,1,0" Padding="4">
                <TextBlock Text="模板（占位）" FontStyle="Italic" Foreground="Gray"/>
            </Border>
            
            <!-- Middle: Script Tree -->
            <Border Grid.Column="1" Grid.Row="0" BorderBrush="#CCC" BorderThickness="0,0,1,0" Padding="4">
                <TreeView x:Name="ScriptTree" SelectedItemChanged="ScriptTree_OnSelectedItemChanged"/>
            </Border>
            
            <!-- Right: Properties -->
            <Border Grid.Column="2" Grid.Row="0" Padding="4">
                <ScrollViewer>
                    <StackPanel x:Name="PropertiesPanel" />
                </ScrollViewer>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="1" Height="5" HorizontalAlignment="Stretch" />

            <!-- Bottom: Validation Panel -->
            <Border Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="2" BorderBrush="#CCC" BorderThickness="0,1,0,0" Padding="4">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    
                    <TextBlock Grid.Row="0" Text="验证结果" FontWeight="Bold" Margin="0,0,0,4" />
                    
                    <ListView Grid.Row="1" x:Name="ValidationList" ItemsSource="{Binding ValidationErrors}" 
                             MouseDoubleClick="ValidationList_MouseDoubleClick">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="严重性" Width="80">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Severity}" 
                                                      Foreground="{Binding Severity, Converter={StaticResource SeverityToColorConverter}}" />
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="消息" Width="400">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Message}" TextWrapping="Wrap" />
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="元素" Width="100">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding ElementId}" />
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="属性" Width="100">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding PropertyName}" />
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>
            </Border>
        </Grid>
    </DockPanel>
</Window>
